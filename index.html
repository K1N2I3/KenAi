<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>KenAi</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="minimal-fix.js"></script>
    <!-- 添加触摸事件最佳实践 -->
    <script>
        // 阻止双击缩放
        document.addEventListener('touchstart', function(event) {
            if (event.touches.length > 1) {
                event.preventDefault();
            }
        }, { passive: false });
        
        // 防止缩放
        document.addEventListener('gesturestart', function(event) {
            event.preventDefault();
        }, { passive: false });
        
        // 修复300ms点击延迟
        document.addEventListener('touchend', function(e) {
            if (e.target.tagName.toLowerCase() === 'button' || 
                e.target.closest('button') ||
                e.target.classList.contains('language-select-header') ||
                e.target.classList.contains('model-select-header') ||
                e.target.classList.contains('language-option') ||
                e.target.classList.contains('model-option')) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    
    <!-- 添加内联样式 -->
    <style>
        /* 确保欢迎消息在发送消息后消失 */
        .hide-welcome #welcomeMessage {
            display: none !important;
        }
        
        /* 修复新对话问题 */
        .chat-item {
            position: relative;
            z-index: 1;
        }
        
        /* 确保对话项可点击 */
        .chat-item-container {
            cursor: pointer;
            width: 100%;
        }
    </style>
</head>
<body>
    <!-- 主应用容器 -->
    <div id="appContainer" class="container">
        <!-- 主题切换效果容器 -->
        <div class="theme-transition-effect" id="themeTransitionEffect"></div>
        
        <div class="sidebar">
            <div class="sidebar-header">
                <button class="toggle-sidebar-btn" id="toggleSidebarBtn">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="logo">
                    <div class="logo-icon">K</div>
                    <div class="logo-text">KenAi</div>
                </div>
            </div>
            <button class="new-chat-btn" id="newChatBtn">
                <i class="fas fa-plus"></i> 开启新对话
            </button>
            
            <div class="chat-history-header">
                今天
                <button id="clearAllChats" class="clear-all-btn" title="清空所有聊天">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
            <div class="chat-history" id="chatHistory">
                <!-- 历史对话将在这里显示 -->
            </div>
            
            <div class="sidebar-footer">
                <button class="settings-btn" id="settingsBtn">
                    <i class="fas fa-cog"></i> <span id="settingsText">设置</span>
                </button>
                <div class="app-version" id="appVersion">KenAi v1.1</div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="chat-container" id="chatContainer">
                <div class="welcome-message" id="welcomeMessage">
                    <div class="welcome-logo">
                        <div class="welcome-icon">K</div>
                    </div>
                    <h2>我是 KenAi，很高兴见到你！</h2>
                    <p>我可以帮你写代码、读文件、写作各种创意内容，请把你的任务交给我吧～</p>
                    <div class="example-prompts">
                        <h3>你可以尝试问我：</h3>
                        <div class="prompt-buttons">
                            <button class="prompt-btn">解释量子计算的基本原理</button>
                            <button class="prompt-btn">帮我写一个简单的Python爬虫</button>
                            <button class="prompt-btn">推荐几本科幻小说</button>
                            <button class="prompt-btn">如何提高英语口语水平</button>
                        </div>
                    </div>
                </div>
                <!-- 聊天消息将在这里显示 -->
            </div>
            
            <div class="input-container">
                <textarea id="userInput" placeholder="给 KenAi 发送消息" rows="1"></textarea>
                <button id="sendBtn" class="send-btn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- 设置模态框 -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="settingsTitle">设置</h2>
            <div class="settings-form">
                <div class="form-group">
                    <label for="apiKey" id="apiKeyLabel">KenAi API 密钥</label>
                    <input type="password" id="apiKey" value="sk-9e6382d54ac645f691bc55191e7ac0e2" readonly>
                </div>
                <div class="form-group">
                    <label for="modelSelect" id="modelSelectLabel">模型选择</label>
                    <div class="select-container">
                        <select id="modelSelect">
                            <option value="deepseek-chat">KenAi 通用模型</option>
                            <option value="deepseek-coder">KenAi 编程模型</option>
                            <option value="deepseek-reasoner">KenAi 推理模型</option>
                        </select>
                    </div>
                </div>
                <!-- 隐藏 API Base URL 设置 -->
                <div class="form-group" style="display: none;">
                    <label for="apiBaseUrl" id="apiBaseUrlLabel">API 基础 URL</label>
                    <input type="text" id="apiBaseUrl" value="https://api.deepseek.com/v1" placeholder="API 基础 URL">
                    <small id="apiBaseUrlHint">默认使用 KenAi API: https://api.deepseek.com/v1</small>
                </div>
                <div class="form-group">
                    <label for="languageSelect" id="languageSelectLabel">语言 / Language</label>
                    <div class="select-container">
                        <select id="languageSelect">
                            <option value="zh">中文</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="darkModeSwitch" id="darkModeLabel">Dark Mode</label>
                    <div class="switch-container">
                        <label class="switch">
                            <input type="checkbox" id="darkModeSwitch">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
                <div class="settings-note" id="settingsNote">所有设置更改会自动保存</div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html> 